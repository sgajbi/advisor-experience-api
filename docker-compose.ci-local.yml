services:
  ci-local:
    build:
      context: .
      dockerfile: Dockerfile
    image: lotus-gateway:ci-local
    working_dir: /app
    volumes:
      - ./:/app
    command:
      [
        "sh",
        "-lc",
        "pip install --no-cache-dir -e '.[dev]' && ruff check . && ruff format --check . && mypy src && python -m pytest tests/unit tests/contract && python -m pytest tests/integration"
      ]
    environment:
      - DECISIONING_SERVICE_BASE_URL=http://host.docker.internal:8000
      - UPSTREAM_TIMEOUT_SECONDS=30
      - CONTRACT_VERSION=v1

